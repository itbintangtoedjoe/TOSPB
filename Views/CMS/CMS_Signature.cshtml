
@{
    ViewBag.Title = "CMS_Signature";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<style>
    .dataTables_filter {
        position: relative;
    }

    .dataTables_filter input {
        width: 250px;
        height: 32px;
        background: #fcfcfc;
        border: 1px solid #aaa;
        border-radius: 5px;
        box-shadow: 0 0 3px #ccc, 0 10px 15px #ebebeb inset;
        text-indent: 10px;
    }

    .dataTables_filter .fa-search {
        position: absolute;
        top: 10px;
        left: auto;
        right: 10px;
    }

    @@media (min-width: 768px) {
        .modal-xl {
            width: 900%;
            max-width: 1300px;
        }
    }
</style>

<div class="container-fluid">
  
    <div class="row">
     
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <h2>CMS Signature</h2>
                    <hr class="solid">
                    <br />
                    <div class="row form-group-sm">
                        <div class="col-md-4">
                            <h4>Choose Directory:</h4>
                            <select id="ddlAD" class="form-control"style="width: 100%">
                                <option value="" class="dropdown-header" selected disabled>Select Directory</option>
                                <option value="isAD" class="dropdown-header">Active Directory</option>
                                <option value="isNotAD" class="dropdown-header">Non Active Directory</option>
                            </select>
                        </div>
                    </div>
                    <br/>

                    @*Not AD*@
                    <div id="divContentNotAD" hidden>
                        <hr class="solid">
                        <h4>Create New User</h4>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <label class="m-t-20">Nama Employee<span style="color: red">*</span></label>

                                <input class="form-control" type="text" id="txtNamaEmployee"/>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <label class="m-t-20">Email Employee<span style="color: red">*</span></label>

                                <input class="form-control" type="text" id="txtEmailEmployee"/>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <label class="m-t-20">Username<span style="color: red">*</span></label>

                                <input class="form-control" type="text" id="txtUsername123"/>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <label class="m-t-20">Password<span style="color: red">*</span></label>

                                <input class="form-control" type="text" id="txtPassword" value="123" disabled/>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <label class="m-t-20">Jabatan<span style="color: red">*</span></label>

                                <input class="form-control" type="text" id="txtJabatan"/>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-6">
                                <label class="m-t-20">Upload Signature<span style="color: red">*</span></label>

                                <div class="input-group">
                                    <input type="file" name="NamaFileUpload" id="idFileUploadAttachNotAD" style="padding-top: 10px; width: 300px;"/>
                                    <button type="button" id="btnUploadBuktiNotAD" class="btn mb-2 btn-success " style="padding-top: 10px;" disabled>Upload File</button>
                                </div>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <button type="button" id="btnCreateUser" class="btn mb-2 btn-primary " style="padding-top: 10px;">Create User</button>
                            </div>
                        </div>
                        <hr class="solid">
                    </div>

                    @*AD*@
                    <div id="divContentAD" hidden>
                        <hr class="solid">
                        <h4>Choose Employee</h4>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-6">
                                <label class="m-t-20">Nama Employee<span style="color: red">*</span></label>
                            </div>
                        </div>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <select id="ddlNama" class="form-control" style="width: 100%">
                                    <option value="" class="dropdown-header" selected disabled>Select Nama Employee</option>
                                </select>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <label class="m-t-20">Username<span style="color: red">*</span></label>

                                <input class="form-control" type="text" id="txtUsernameAD" disabled placeholder="-"/>
                            </div>
                        </div>
                        <br/>
                        <div class="row form-group-sm">
                            <div class="col-md-4">
                                <label class="m-t-20">Jabatan<span style="color: red">*</span></label>

                                <input class="form-control" type="text" id="txtJabatanAD" disabled placeholder="-"/>
                            </div>
                        </div>
                        @*Upload Signature*@
                        <div id="divUploadSignature">
                            <br/>
                            <div class="row form-group-sm">
                                <div class="col-md-6">
                                    <label class="m-t-20">Upload Signature<span style="color: red">*</span></label>

                                    <div class="input-group">
                                        <input type="file" name="NamaFileUpload" id="idFileUploadAttachAD" style="padding-top: 10px; width: 300px;"/>
                                        <button type="button" id="btnUploadBuktiAD" class="btn mb-2 btn-success " style="padding-top: 10px;" disabled>Upload File</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row form-group-sm mt-3">
                                <div class="col-md-6">
                                    <button class="btn btn-primary" id="insertSignature">Upload Signature</button>
                                </div>
                            </div>
                        </div>
                        <hr class="solid">
                    </div>

                    @*Table Signature*@
                    <div class="row form-group-sm mt-3" id="divTable">

                        <div class="col-md-12">
                            <div id="form_tableSPB" class="form-group row">
                                <table id="tbl_Signature" class="table table-striped table-bordered zero-configuration" style="width: 100%">
                                    <thead>
                                    <tr>
                                        <th>No</th>
                                        <th></th>
                                        <th></th>
                                        <th>Nama</th>
                                        <th>Jabatan</th>
                                        <th>Creation Date</th>
                                        <th>Created By</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody id="tBodySignature">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .select2-selection__rendered {
        line-height: 40px !important;
    }
    .select2-container .select2-selection--single {
        height: 40px !important;
    }
    .select2-selection__arrow {
        height: 40px !important;
    }
</style>

@*Popup Modal for Update Btn*@
<div class="modal fade" id="modalUpdate" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Update Employee</h5>
            </div>
            <div class="modal-body">
                <div class="row form-group-sm">
                    <div class="col-md-5">
                        <label class="m-t-20">Nama Employee</label>
                        <input class="form-control" type="text" id="txtUpdateName" />
                    </div>
                </div>
                <br />
                <div class="row form-group-sm">
                    <div class="col-md-5">
                        <label class="m-t-20">Jabatan</label>
                        <input class="form-control" type="text" id="txtUpdateJabatan" />
                    </div>
                </div>
                <br />
                <div class="row form-group-sm" id="divResetPassword">
                    <div class="col-md-5">
                        <label for="resetPasswordCB" > Reset Password</label> 
                        <input type="checkbox" id="resetPasswordCB" value="Reset" name="resetPasswordCB" style="margin-left: 10px;">
                    </div>
                </div>
                <br/>
                <div class="row form-group-sm">
                    <div class="col-md-5">
                        <label class="m-t-20">Upload Signature</label>
                        <div class="input-group">
                            <input type="file" name="NamaFileUpload" id="idFileUploadAttachUpdate" style="padding-top: 10px; width: 300px;" />
                            <button type="button" id="btnUploadBuktiUpdate" class="btn mb-2 btn-success " style="padding-top: 10px;" disabled>Upload File</button>
                        </div>
                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary"style="background-color: red; border-color: red" data-dismiss="modal" id="Cancel">Cancel</button>
                <button type="button" class="btn btn-primary" id="btn_UpdateNotAD">Update</button>
            </div>
        </div>
    </div>
</div>

<script>
    var filePathAD = '';
    var filePathNotAD = '';
    var filePathUpdate = '';
    var flagUploadedFileAD = 'false';
    var flagUploadedFileNotAD = 'false';
    var flagUploadedFileUpdate = 'false';
    var RecordId = '';

    $(document).ready(function () {
        getTableData();
        GetNamaEmployee();
        $('#ddlNama').select2();
        $('#ddlAD').select2();

        $('input[type=file]').change(function () {
            var filenameAD = $('#idFileUploadAttachAD').val();
            var filenameNotAD = $('#idFileUploadAttachNotAD').val();
            var filenameUpdate = $('#idFileUploadAttachUpdate').val();

            if (filenameAD == '') {
                $('#btnUploadBuktiAD').attr("disabled", true);

            } else {
                $('#btnUploadBuktiAD').attr("disabled", false);
            }

            if (filenameNotAD == '') {
                $('#btnUploadBuktiNotAD').attr("disabled", true);

            } else {
                $('#btnUploadBuktiNotAD').attr("disabled", false);
            }

            if (filenameUpdate == '') {
                $('#btnUploadBuktiUpdate').attr("disabled", true);

            } else {
                $('#btnUploadBuktiUpdate').attr("disabled", false);
            }

        });

        $('#ddlAD').change(function () {
            $('#ddlNama').val('');
            $('#idFileUploadAttachNotAD').val('');
            $('#idFileUploadAttachAD').val('');

            if ($('#ddlAD').val() === 'isNotAD') {
                $('#divContentNotAD').attr('hidden', false);
                $('#divContentAD').attr('hidden', true);

            } else {
                $('#divContentAD').attr('hidden', false);
                $('#divContentNotAD').attr('hidden', true);

            }
        });

        $('#ddlNama').change(function () {
            GetUsername_Jabatan();
        });

        $("#btnCreateUser").click(function () {
           
            if ($('#txtNamaEmployee').val() == '' || $('#txtNamaEmployee').val() == null) {
                swal({
                    title: "Warning!",
                    text: "Silahkan Mengisi Nama Employee Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else if ($('#txtUsername123').val() == '' || $('#txtUsername123').val() == null) {
                swal({
                    title: "Warning!",
                    text: "Silahkan Mengisi Username Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else if ($('#txtEmailEmployee').val() == '' || $('#txtEmailEmployee').val() == null) {
                swal({
                    title: "Warning!",
                    text: "Silahkan Mengisi Email Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else if ($('#txtJabatan').val() == '' || $('#txtJabatan').val() == null) {
                swal({
                    title: "Warning!",
                    text: "Silahkan Mengisi Jabatan Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else if ($('#idFileUploadAttachNotAD').val() == '' || $('#idFileUploadAttachNotAD').val() == null) {
                swal({
                    title: "Warning!",
                    text: "Silahkan Memilih File Signature Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else if (flagUploadedFileNotAD === 'false') {
                swal({
                    title: "Warning!",
                    text: "Silahkan Mengupload File Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else {
                CreateUser();
                location.reload();
                $('#btnCreateUser').attr('disabled', true);
            }

           
        });

        $("#insertSignature").click(function () {
            @*alert($('#ddlNama').val())*@
            if ($('#ddlNama').val() == '' || $('#ddlNama').val() == null) {
                swal({
                    title: "Warning!",
                    text: "Silahkan Memilih Nama Employee Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else if ($('#idFileUploadAttachAD').val() == '' || $('#idFileUploadAttachAD').val() == null) {
                swal({
                    title: "Warning!",
                    text: "Silahkan Memilih File Signature Terlebih Dahulu!",
                    type: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
            else {
                insertSignature();
                $('#ddlNama').attr('disabled', true);
                location.reload();
                $('#btnReloadPage').attr('hidden', false);
            }
        });

        $('#tbl_Signature').on('click',
            'tbody tr .delete', function () {

                Swal.fire({
                    type: 'warning',
                    title: 'Delete Data?',
                    text: 'Data akan terhapus',
                    showConfirmButton: true,

                }).then((result) => {
                    if (result.value) {

                        var row = $(this).closest("TR");
                        var data = $('#tbl_Signature').DataTable().row(row).data();
                        var recordid = data['RecordId'];

                        var dictlist = {
                            Option: "Delete Data",
                            RecordID: recordid
                        }

                        var dto = {
                            Model: dictlist
                        }

                        $.ajax({
                            url: "../UploadMemo/DynamicController?spname=SP_Signature",
                            type: "POST",
                            dataType: "json",
                            data: JSON.stringify(dto),
                            contentType: "application/json;charset=utf-8",
                            success: function (data) {
                                swal({
                                    title: "Data Deleted!",
                                    type: "success",
                                    showConfirmButton: false,
                                    timer: 2000,
                                });
                                getTableData();
                            }, error: function (ex) {
                                console.log(JSON.stringify(ex));
                            }
                        });
                    }
                })
        });

        $('#tbl_Signature').on('click',
            'tbody tr .update', function () {
                var row = $(this).closest("TR");
                var data = $('#tbl_Signature').DataTable().row(row).data();
                RecordId = data['RecordId'];

                $('#txtUpdateName').val(data['Nama']);
                $('#txtUpdateJabatan').val(data['Jabatan']);
                $('#idFileUploadAttachUpdate').text('testaja');

                $('#modalUpdate').modal('show');
                @*alert(data['NewAccountFlag'])*@
                if (data['ADFlag'] == 'isAD') {
                    $('#txtUpdateName').attr('disabled', true);
                    $('#divResetPassword').attr('hidden', true);
                } else {
                    $('#txtUpdateJabatan').attr('disabled', false);
                    $('#txtUpdateName').attr('disabled', false);
                    $('#divResetPassword').attr('hidden', false);   
                }
            });

        $("#btnUploadBuktiAD").click(function () {
            flagUploadedFileAD = 'true';
            uploadFileSignatureAD();
        });

        $("#btnUploadBuktiNotAD").click(function () {
            flagUploadedFileNotAD = 'true';
             uploadFileSignatureNotAD();
        });

        $("#btnUploadBuktiUpdate").click(function () {
            flagUploadedFileUpdate = 'true';
            uploadFileSignatureUpdate();
        });

        $("#btn_UpdateNotAD").click(function () {
           @* alert($('#idFileUploadAttachUpdate').val());*@
            if ($('#idFileUploadAttachUpdate').val() !== '') {
                if (flagUploadedFileUpdate == 'false') {
                    Swal.fire({
                        title: "Warning!",
                        text: "Mohon Mengupload File Terlebih Dahulu!",
                        type: "warning",
                        showConfirmButton: false,
                        timer: 2000
                    });
                } else {
                    updateUser();
                }
            }
            else {
                updateUser();
            }
        });

    });

    function uploadFileSignatureAD() {
        var file = '';
        var formData = new FormData();
        var totalFiles = document.getElementById("idFileUploadAttachAD").files.length;
        for (var i = 0; i < totalFiles; i++) {
            file = document.getElementById("idFileUploadAttachAD").files[i];
            formData.append("idFileUploadAttachAD", file);
        }
        if (file != null && file != "") {
            $.ajax({
                type: "POST",
                url: 'CMS_UploadFile',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                success: function (data) {
                    filePathAD = data;
                    swal({
                        title: "Success",
                        text: "Upload File Signature Berhasil!",
                        type: "success",
                        timer: 3000,
                        showConfirmButton: false
                    });
                    $('#btnUploadBuktiAD').attr('disabled', true);
                    $('#idFileUploadAttachAD').attr('disabled', true);

                },
                error: function (error) {
                    alert(error);
                }
            });
        } else {
            Swal.fire({
                title: "Warning",
                text: "Pilih Attachment Terlebih dahulu",
                type: "warning",
                timer: 2000,
                showConfirmButton: false
            });
        }
    }

    function uploadFileSignatureNotAD() {
        var file = '';
        var formData = new FormData();
        var totalFiles = document.getElementById("idFileUploadAttachNotAD").files.length;
        for (var i = 0; i < totalFiles; i++) {
            file = document.getElementById("idFileUploadAttachNotAD").files[i];
            formData.append("idFileUploadAttachNotAD", file);
        }
        if (file != null && file != "") {
            $.ajax({
                type: "POST",
                url: 'CMS_UploadFile',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                success: function (data) {
                    filePathNotAD = data;
                    swal({  
                        title: "Success",
                        text: "Upload File Signature Berhasil!",
                        type: "success",
                        timer: 3000,
                        showConfirmButton: false
                    });
                    $('#btnUploadBuktiNotAD').attr('disabled', true);
                    $('#idFileUploadAttachNotAD').attr('disabled', true);

                },
                error: function (error) {
                    alert(error);
                }
            });
        } else {
            Swal.fire({
                title: "Warning",
                text: "Pilih Attachment Terlebih dahulu",
                type: "warning",
                timer: 2000,
                showConfirmButton: false
            });
        }
    }

    function uploadFileSignatureUpdate() {
        var file = '';
        var formData = new FormData();
        var totalFiles = document.getElementById("idFileUploadAttachUpdate").files.length;
        for (var i = 0; i < totalFiles; i++) {
            file = document.getElementById("idFileUploadAttachUpdate").files[i];
            formData.append("idFileUploadAttachUpdate", file);
        }
        if (file != null && file != "") {
            $.ajax({
                type: "POST",
                url: 'CMS_UploadFile',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                success: function (data) {
                    filePathUpdate = data;
                    swal({
                        title: "Success",
                        text: "Upload File Signature Berhasil!",
                        type: "success",
                        timer: 3000,
                        showConfirmButton: false
                    });
                    $('#btnUploadBuktiUpdate').attr('disabled', true);
                    $('#idFileUploadAttachUpdate').attr('disabled', true);

                },
                error: function (error) {
                    alert(error);
                }
            });
        } else {
            Swal.fire({
                title: "Warning",
                text: "Pilih Attachment Terlebih dahulu",
                type: "warning",
                timer: 2000,
                showConfirmButton: false
            });
        }
    }

    function getTableData() {
        var dictlist = {
            Option: "Get Table Signature"
        }
        var dto = {
            Model: dictlist
        }
        $.ajax({
            url: "../UploadMemo/DynamicController?spname=SP_Signature",
            type: "POST",
            dataType: "json",
            data: JSON.stringify(dto),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                var table = $('#tbl_Signature').DataTable({
                    "pageLength": 10,
                    "data": JSON.parse(data),
                    "filter": true,
                    "lengthChange": true,
                    "paging": true,
                    "info": true,
                    "searching": true,
                    "select": true,
                    "bDestroy": true,
                    "scrollCollapse": true,
                    "columns": [
                        {  "data": "id",
                            render: function (data, type, row, meta) {
                                return meta.row + meta.settings._iDisplayStart + 1;
                            }
                        },
                        { "data": "RecordId", "visible": false },
                        { "data": "ADFlag", "visible": false },
                        { "data": "Nama" },
                        { "data": "Jabatan" },
                        @*{ "data": "Path_image" },*@
                        { "data": "CreationDate" },
                        { "data": "CreatedBy" },
                        {
                            "data": null,
                            "defaultContent": '<input type="button" class="btn btn-primary update" style="background-color:orange; border-color: orange" id="btn_Update" value="Update" />'
                        },

                        {
                            "data": null,
                            "defaultContent": "<input class='btn btn-primary delete' id='btn_Delete' style='background-color:red; border-color:red' type='button' value='Delete' />"
                        },
                    ],

                    "order": [[0, 'asc']],
                    "columnDefs": [
                        { "width": "5%", "targets": 0 },
                        { "width": "50%", "targets": [1] },
                        { "width": "30%", "targets": [2] },
                        { "width": "20%", "targets": [3,4,5,6] },
                        { "width": "5%", "targets": [7,8] },
                        { "className": "text-center", "targets": 0}
                    ]
                });

            }, error: function (ex) {
                console.log(JSON.stringify(ex));
            }
        });
        //var row = table.row(i);
        //var tr = $(row.node());
        //var checkbox = tr.find('td:first-child input[type="checkbox"]')

    }

    function CreateUser() {
       @* alert(filePathNotAD)*@
       var dictlist = {
            Option: "Insert New User",
            NamaEmployee: $('#txtNamaEmployee').val(),
            Username: $('#txtUsername123').val(),
            Password: $('#txtPassword').val(),
            Jabatan: $('#txtJabatan').val(),
            Email: $('#txtEmailEmployee').val(),
            FileName: filePathNotAD,
            Uploader: "@Request.RequestContext.HttpContext.Session["UserName"]"
        }

       var dto = {
            Model: dictlist
        }
   
        $.ajax({
            url: "../UploadMemo/DynamicController?spname=SP_Signature",
            type: "POST",
            dataType: "json",
            data: JSON.stringify(dto),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                var result = JSON.parse(data);

                swal({
                    title: "Success!",
                    text: "User Berhasil Didaftarkan!",
                    type: "success",
                    showConfirmButton: false,
                    timer: 3000
                });

                $('#btnCreateUser').attr('disabled', true);
                $('#txtJabatan').attr('disabled', true);
                $('#txtUsername123').attr('disabled', true);
                $('#txtEmailEmployee').attr('disabled', true);
                $('#txtNamaEmployee').attr('disabled', true);
                $('#txtPassword').attr('disabled', true);
                $('#idFileUploadAttachNotAD').attr('disabled', true);
                $('#btnUploadBuktiNotAD').attr('disabled', true);

                getTableData();
            }, error: function (ex) {
                console.log(JSON.stringify(ex));
            }
        });
        
    }

    function insertSignature() {
        var dictlist = {
            Option: "Upload Signature",
            NamaEmployee: $('#ddlNama option:selected').text(),
            FileName: filePathAD,
            Uploader: "@Request.RequestContext.HttpContext.Session["UserName"]"
        }

        var dto = {
            Model: dictlist
        }
        if (flagUploadedFileAD === 'false') {
            Swal.fire({
                title: "Warning!",
                text: "Mohon Mengupload File Terlebih Dahulu!",
                type: "warning",
                showConfirmButton: false,
                timer: 2000
            });
        } else {
            $.ajax({
                url: "../UploadMemo/DynamicController?spname=SP_Signature",
                type: "POST",
                dataType: "json",
                data: JSON.stringify(dto),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    Swal.fire({
                        title: "Success!",
                        text: "Tanda Tangan Berhasil Didaftarkan!",
                        type: "success",
                        showConfirmButton: false,
                        timer: 3000
                    });
                    $('#insertSignature').attr('disabled', true);
                    getTableData();
                }, error: function (ex) {
                    console.log(JSON.stringify(ex));
                }
            });
        }

    }

    function GetNamaEmployee() {
        var dictlist = {
            Option: "Get Nama DDL"
        }
        var dto = {
            Model: dictlist
        }
        $.ajax({
            url: "../UploadMemo/DynamicController?spname=SP_Signature",
            type: "post",
            dataType: "json",
            data: JSON.stringify(dto),
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                var result = JSON.parse(data);
                var trhtml = "";
                var trav = 0;
                var count = result.length;
                @*console.log(result)*@
                trhtml += '<option disabled selected class="dropdown-header" value="">Select Nama Employee</option>';
                if (count > 0) {
                    for (trav = 0; trav < count; trav++) {

                        trhtml +=
                            '<option class="dropdown-item" value = "' + trav + '" > ' + result[trav].Username + '</option >';
                    }
                }

                $("#ddlNama").empty();
                $("#ddlNama").append(trhtml);

            }, error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });

    }

    function GetUsername_Jabatan() {
        var dictlist = {
            Option: "Get Username and Jabatan",
            NamaEmployee: $('#ddlNama option:selected').text()
        }

        var dto = {
            Model: dictlist
        }
        $.ajax({
            url: "../UploadMemo/DynamicController?spname=SP_Signature",
            type: "post",
            dataType: "json",
            data: JSON.stringify(dto),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                var result = JSON.parse(data);

                $('#txtJabatanAD').val(result[0].JobTtlName);
                $('#txtUsernameAD').val(result[0].UserAD);
                console.log(result);
            }, error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function updateUser() {
        var ResetPasswordFlag = 'false';
        if ($('#resetPasswordCB').is(":checked")) {
            ResetPasswordFlag = 'true';
        }
@*        alert("@Request.RequestContext.HttpContext.Session["UserName"]")
*@        var dictlist = {
            Option: "Update User",
            NamaEmployee: $('#txtUpdateName').val(),
            Jabatan: $('#txtUpdateJabatan').val(),
            FileName: filePathUpdate,
            RecordID: RecordId,
            ResetPasswordFlag: ResetPasswordFlag,
            Uploader: "@Request.RequestContext.HttpContext.Session["UserName"]"
        }

        var dto = {
            Model: dictlist
        }

        $.ajax({
            url: "../UploadMemo/DynamicController?spname=SP_Signature",
            type: "POST",
            dataType: "json",
            data: JSON.stringify(dto),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                Swal.fire({
                    title: "Success!",
                    text: "Update Data User Berhasil!",
                    type: "success",
                    showConfirmButton: false,
                    timer: 2000
                }).then(() => {
                    $('#modalUpdate').modal('hide');
                });
                getTableData();
            }, error: function (ex) {
                console.log(JSON.stringify(ex));
            }
        });

    }

</script>

